---
import { db, BlogPosts } from 'astro:db';
import MainLayout from '../../../layouts/MainLayout.astro';

const clusterTag = 'testing-simulation';
const allArticles = await db.select().from(BlogPosts);
const articles = allArticles.filter((post) => {
  if (!post.tags || !Array.isArray(post.tags)) return false;
  return post.tags.includes(clusterTag);
});

const clusterInfo = {
  title: 'Testing & Simulation',
  description: 'Ensure network configuration reliability through safe testing practices, Simunet integration, and CI/CD pipeline automation with NetDriver.',
  focus: ['Simunet', 'CI/CD', 'Safe Testing'],
  slug: 'testing-simulation',
};
---

<MainLayout
  title={`${clusterInfo.title} - NetDriver Topics`}
  description={clusterInfo.description}
>
  <!-- Animated Background -->
  <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
    <div class="absolute inset-0 bg-gradient-to-br from-slate-blue-50 via-white to-sky-50"></div>
    <!-- Animated SVG shapes -->
    <svg class="absolute inset-0 w-full h-full opacity-30" viewBox="0 0 1440 1000" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice">
      <defs>
        <linearGradient id="testGrad1" gradientUnits="userSpaceOnUse" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="rgb(92,178,214)" stop-opacity="0.3"/>
          <stop offset="100%" stop-color="rgb(81,118,151)" stop-opacity="0.2"/>
        </linearGradient>
        <linearGradient id="testGrad2" gradientUnits="userSpaceOnUse" x1="100%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="rgb(18,57,104)" stop-opacity="0.25"/>
          <stop offset="100%" stop-color="rgb(65,97,133)" stop-opacity="0.15"/>
        </linearGradient>
        <linearGradient id="testGrad3" gradientUnits="userSpaceOnUse" x1="50%" y1="0%" x2="50%" y2="100%">
          <stop offset="0%" stop-color="rgb(72,104,141)" stop-opacity="0.2"/>
          <stop offset="100%" stop-color="rgb(90,171,206)" stop-opacity="0.1"/>
        </linearGradient>
        <radialGradient id="testGrad4" cx="50%" cy="50%">
          <stop offset="0%" stop-color="rgb(92,178,214)" stop-opacity="0.25"/>
          <stop offset="100%" stop-color="rgb(81,118,151)" stop-opacity="0"/>
        </radialGradient>
      </defs>
      <!-- Floating shapes -->
      <path class="test-shape-1" d="M 0 180 Q 380 130 760 180 T 1520 180 L 1520 0 L 0 0 Z" fill="url(#testGrad1)"/>
      <path class="test-shape-2" d="M 0 820 Q 520 770 1040 820 T 2080 820 L 2080 1000 L 0 1000 Z" fill="url(#testGrad2)"/>
      <circle class="test-shape-3" cx="1150" cy="320" r="170" fill="url(#testGrad3)"/>
      <circle class="test-shape-4" cx="220" cy="680" r="190" fill="url(#testGrad4)"/>
      <ellipse class="test-shape-5" cx="650" cy="140" rx="130" ry="90" fill="url(#testGrad2)"/>
      <path class="test-shape-6" d="M 1050 0 Q 1150 70 1250 0 L 1250 140 Q 1150 70 1050 140 Z" fill="url(#testGrad1)"/>
    </svg>
    <!-- Additional gradient overlay -->
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-slate-blue-50/50"></div>
  </div>

  <article class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <header class="mb-12 text-center">
      <h1 class="text-4xl font-bold text-navy-800 mb-4">
        {clusterInfo.title}
      </h1>
      <p class="text-xl text-slate-blue-600 max-w-3xl mx-auto mb-6">
        {clusterInfo.description}
      </p>
      <div class="flex flex-wrap justify-center gap-3">
        {clusterInfo.focus.map((topic) => (
          <span class="px-4 py-2 bg-sky-100 text-sky-700 rounded-full text-sm font-medium">
            {topic}
          </span>
        ))}
      </div>
    </header>

    <section class="mb-12">
      <div class="bg-gradient-to-br from-blue-50 to-slate-blue-50 rounded-xl p-8 border-2 border-slate-blue-200">
        <h2 class="text-2xl font-bold text-navy-800 mb-4">
          What is Testing & Simulation?
        </h2>
        <div class="prose prose-lg max-w-none text-slate-blue-700">
          <p class="text-lg mb-4">
            Network automation requires rigorous testing to prevent configuration errors that could disrupt production environments. 
            NetDriver provides comprehensive testing and simulation capabilities:
          </p>
          <ul class="list-disc list-inside space-y-2 ml-4">
            <li><strong>Simunet Integration:</strong> Test network configurations in isolated simulation environments before deployment</li>
            <li><strong>CI/CD Pipeline Support:</strong> Integrate network automation into continuous integration workflows</li>
            <li><strong>Safe Testing Practices:</strong> Validate configurations without impacting production infrastructure</li>
            <li><strong>Automated Validation:</strong> Ensure network changes meet compliance and security requirements</li>
          </ul>
        </div>
      </div>
    </section>

    {articles.length > 0 ? (
      <section>
        <h2 class="text-3xl font-bold text-navy-800 mb-8">
          Related Articles
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {articles.map((article) => (
            <a
              href={`/topics/${clusterInfo.slug}/${article.slug}`}
              class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 border-2 border-slate-blue-200 hover:border-sky-400 transform hover:-translate-y-1 group"
            >
              {article.heroImage && (
                <div class="aspect-video bg-slate-blue-100 overflow-hidden">
                  <img
                    src={article.heroImage}
                    alt={article.title}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                    loading="lazy"
                    width="400"
                    height="225"
                  />
                </div>
              )}
              <div class="p-6">
                <h3 class="text-xl font-semibold text-navy-800 mb-2 group-hover:text-sky-500 transition-colors">
                  {article.title}
                </h3>
                <p class="text-slate-blue-600 text-sm mb-4 line-clamp-2">
                  {article.description}
                </p>
                <div class="flex items-center justify-between text-sm text-slate-blue-500">
                  <time datetime={article.pubDate.toISOString()}>
                    {article.pubDate.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </time>
                </div>
              </div>
            </a>
          ))}
        </div>
      </section>
    ) : (
      <section class="text-center py-12">
        <p class="text-slate-blue-600 text-lg">
          Articles for this topic cluster are coming soon. Check back later!
        </p>
      </section>
    )}

    <aside class="mt-12 bg-navy-700 text-white rounded-xl p-8">
      <h2 class="text-2xl font-bold mb-4">Explore Other Topics</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <a
          href="/topics/scaling-automation"
          class="p-4 bg-navy-600 rounded-lg hover:bg-navy-500 transition-colors"
        >
          <h3 class="font-semibold mb-2">Scaling Automation</h3>
          <p class="text-sm text-sky-200">
            AsyncSSH, concurrency, and session management
          </p>
        </a>
        <a
          href="/topics/legacy-integration"
          class="p-4 bg-navy-600 rounded-lg hover:bg-navy-500 transition-colors"
        >
          <h3 class="font-semibold mb-2">Legacy Integration</h3>
          <p class="text-sm text-sky-200">
            REST wrappers, CLI-to-API conversion, and vendor plugins
          </p>
        </a>
      </div>
    </aside>
  </article>
</MainLayout>

<style>
  @keyframes testFloat1 {
    0%, 100% { transform: translateY(0px) translateX(0px); }
    50% { transform: translateY(-30px) translateX(20px); }
  }
  
  @keyframes testFloat2 {
    0%, 100% { transform: translateY(0px) translateX(0px); }
    50% { transform: translateY(22px) translateX(-16px); }
  }
  
  @keyframes testFloat3 {
    0%, 100% { transform: translateY(0px) scale(1); }
    50% { transform: translateY(-26px) scale(1.12); }
  }
  
  @keyframes testFloat4 {
    0%, 100% { transform: translateY(0px) scale(1); }
    50% { transform: translateY(16px) scale(0.88); }
  }
  
  @keyframes testFloat5 {
    0%, 100% { transform: translateX(0px) rotate(0deg); }
    50% { transform: translateX(30px) rotate(6deg); }
  }
  
  @keyframes testFloat6 {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(-5deg); }
  }

  .test-shape-1 {
    animation: testFloat1 21s ease-in-out infinite;
  }
  
  .test-shape-2 {
    animation: testFloat2 27s ease-in-out infinite;
  }
  
  .test-shape-3 {
    animation: testFloat3 18s ease-in-out infinite;
  }
  
  .test-shape-4 {
    animation: testFloat4 23s ease-in-out infinite;
  }
  
  .test-shape-5 {
    animation: testFloat5 15s ease-in-out infinite;
  }
  
  .test-shape-6 {
    animation: testFloat6 20s ease-in-out infinite;
  }
</style>
